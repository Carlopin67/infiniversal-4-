<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta name="theme-color" content="#1a1a2e" />
  <meta name="description" content="Bloc de notas creativo para poetas y compositores" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="Infiniversal" />
  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon" href="icons/icon-192.png" />
  <link rel="stylesheet" href="style.css" />
  <title>Infiniversal</title>
</head>
<body class="theme-dark">

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       TUTORIAL / BIENVENIDA (primera ejecuciÃ³n)
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="tutorial-overlay" class="overlay hidden">
    <div class="tutorial-card">
      <div class="tutorial-steps">
        <div class="tutorial-step active" data-step="1">
          <div class="tutorial-icon">âœ¦</div>
          <h2>Bienvenido a<br><span class="brand-name">Infiniversal</span></h2>
          <p>Tu espacio creativo para poesÃ­a y letras de canciones. Offline, elegante y siempre contigo.</p>
        </div>
        <div class="tutorial-step" data-step="2">
          <div class="tutorial-icon">â—ˆ</div>
          <h2>Crea y organiza</h2>
          <p>Escribe poemas con estructura guiada o compÃ³n canciones con secciones marcadas (Intro, Verso, Estribillo...).</p>
        </div>
        <div class="tutorial-step" data-step="3">
          <div class="tutorial-icon">â—‰</div>
          <h2>Herramientas para escritores</h2>
          <p>Contador de sÃ­labas siempre activo, deshacer/rehacer, zoom de texto, tema claro/oscuro y mucho mÃ¡s.</p>
        </div>
        <div class="tutorial-step" data-step="4">
          <div class="tutorial-icon">â¬¡</div>
          <h2>Todo offline</h2>
          <p>Tus notas se guardan localmente. Sin internet. Sin lÃ­mites. Solo tÃº y tus palabras.</p>
        </div>
      </div>
      <div class="tutorial-dots">
        <span class="dot active" data-dot="1"></span>
        <span class="dot" data-dot="2"></span>
        <span class="dot" data-dot="3"></span>
        <span class="dot" data-dot="4"></span>
      </div>
      <div class="tutorial-actions">
        <button id="tutorial-prev" class="btn-ghost hidden">Anterior</button>
        <button id="tutorial-next" class="btn-primary">Siguiente</button>
        <button id="tutorial-skip" class="btn-link">Saltar</button>
      </div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       PROMPT DE INSTALACIÃ“N PWA (modal flotante)
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="install-prompt" class="overlay hidden">
    <div class="install-card">
      <button id="install-close" class="btn-icon-close" aria-label="Cerrar">âœ•</button>
      <div class="install-logo">âˆ</div>
      <h2>Instala <span class="brand-name">Infiniversal</span></h2>
      <p>AÃ±ade la app a tu pantalla de inicio para acceder mÃ¡s rÃ¡pido y usarla sin conexiÃ³n.</p>
      <!-- Hint para Safari iOS (se muestra solo en iOS) -->
      <p id="ios-hint" class="ios-hint hidden">
        En Safari: pulsa <strong>Compartir â†‘</strong> (barra inferior) y luego <strong>"AÃ±adir a pantalla de inicio"</strong>.
      </p>
      <div class="install-actions">
        <button id="install-accept" class="btn-primary">Instalar ahora</button>
        <button id="install-dismiss" class="btn-ghost">Ahora no</button>
      </div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       MODAL: ELEGIR TIPO DE NOTA
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="type-modal" class="overlay hidden">
    <div class="modal-card">
      <h2>Nueva nota</h2>
      <p class="modal-subtitle">Â¿QuÃ© vas a crear hoy?</p>
      <div class="type-grid">
        <button class="type-btn" data-type="poem">
          <span class="type-icon">â—</span>
          <span class="type-label">PoesÃ­a</span>
          <span class="type-desc">Sonetos, cuartetos, liras...</span>
        </button>
        <button class="type-btn" data-type="song">
          <span class="type-icon">â™©</span>
          <span class="type-label">CanciÃ³n</span>
          <span class="type-desc">Verso, estribillo, puente...</span>
        </button>
      </div>
      <button id="type-cancel" class="btn-link">Cancelar</button>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       MODAL: ESTRUCTURA POÃ‰TICA
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="poem-structure-modal" class="overlay hidden">
    <div class="modal-card">
      <h2>Estructura poÃ©tica</h2>
      <p class="modal-subtitle">Elige la forma de tu poema</p>
      <div class="structure-list">
        <button class="structure-btn" data-structure="soneto">
          <strong>Soneto</strong>
          <span>2 cuartetos + 2 tercetos Â· 14 versos</span>
        </button>
        <button class="structure-btn" data-structure="cuarteto">
          <strong>Cuarteto</strong>
          <span>4 versos Â· rima ABBA</span>
        </button>
        <button class="structure-btn" data-structure="lira">
          <strong>Lira</strong>
          <span>5 versos Â· heptasÃ­labos y endecasÃ­labos</span>
        </button>
        <button class="structure-btn" data-structure="haiku">
          <strong>Haiku</strong>
          <span>3 versos Â· 5-7-5 sÃ­labas</span>
        </button>
        <button class="structure-btn" data-structure="silva">
          <strong>Silva</strong>
          <span>Versos heptasÃ­labos y endecasÃ­labos libres</span>
        </button>
        <button class="structure-btn" data-structure="libre">
          <strong>Verso libre</strong>
          <span>Sin estructura fija Â· libertad total</span>
        </button>
      </div>
      <button id="poem-structure-back" class="btn-link">â† Volver</button>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       MODAL: AJUSTES
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="settings-modal" class="overlay hidden">
    <div class="modal-card settings-card">
      <div class="modal-header">
        <h2>Ajustes</h2>
        <button id="settings-close" class="btn-icon-close">âœ•</button>
      </div>

      <!-- Apariencia -->
      <div class="settings-section">
        <h3>Apariencia</h3>
        <div class="setting-row">
          <label>Tema</label>
          <div class="theme-toggle-group">
            <button class="theme-opt active" data-theme="dark">Oscuro</button>
            <button class="theme-opt" data-theme="light">Claro</button>
          </div>
        </div>
        <div class="setting-row">
          <label>TamaÃ±o de texto</label>
          <div class="zoom-controls">
            <button id="zoom-out" class="btn-icon">âˆ’</button>
            <span id="zoom-label">100%</span>
            <button id="zoom-in" class="btn-icon">+</button>
          </div>
        </div>
      </div>

      <!-- Editor -->
      <div class="settings-section">
        <h3>Editor</h3>
        <div class="setting-row">
          <label>Formato de texto (negrita, cursiva...)</label>
          <label class="toggle-switch">
            <input type="checkbox" id="toggle-rich" />
            <span class="slider"></span>
          </label>
        </div>
        <div class="setting-row">
          <label>Herramientas de mÃ©trica y ritmo</label>
          <label class="toggle-switch">
            <input type="checkbox" id="toggle-metric" />
            <span class="slider"></span>
          </label>
        </div>
      </div>

      <!-- Instalar app -->
      <div class="settings-section" id="install-section">
        <h3>Instalar app</h3>
        <!-- Estado A: Chrome/Edge con prompt disponible -->
        <div id="install-state-native" class="install-state hidden">
          <p class="settings-about">Instala Infiniversal en tu pantalla de inicio para usarla sin abrir el navegador.</p>
          <button id="btn-install-settings" class="btn-primary" style="margin-top:10px">â¬‡ Instalar Infiniversal</button>
        </div>
        <!-- Estado B: Safari iOS, instrucciones manuales -->
        <div id="install-state-ios" class="install-state hidden">
          <p class="settings-about">
            En Safari: pulsa el botÃ³n <strong style="color:var(--accent)">Compartir â†‘</strong> en la barra inferior
            y selecciona <strong style="color:var(--accent)">"AÃ±adir a pantalla de inicio"</strong>.
          </p>
        </div>
        <!-- Estado C: ya instalada -->
        <div id="install-state-done" class="install-state hidden">
          <p class="settings-about">âœ“ Infiniversal ya estÃ¡ instalada en tu dispositivo.</p>
        </div>
        <!-- Estado D: navegador sin soporte -->
        <div id="install-state-unsupported" class="install-state hidden">
          <p class="settings-about">
            Tu navegador no soporta instalaciÃ³n directa.<br>
            Prueba con <strong style="color:var(--accent)">Chrome o Edge</strong> en Android/PC,
            o <strong style="color:var(--accent)">Safari</strong> en iPhone/iPad.
          </p>
        </div>
        <!-- Estado E: esperando que el navegador prepare el prompt -->
        <div id="install-state-waiting" class="install-state">
          <p class="settings-about">Preparando instalaciÃ³n... Espera un momento y vuelve a abrir Ajustes.</p>
        </div>
      </div>

      <!-- Acerca de -->
      <div class="settings-section">
        <h3>Acerca de</h3>
        <p class="settings-about">Infiniversal v1.0 Â· Offline Â· Hecho con amor por poetas para poetas.</p>
      </div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       MODAL: AYUDA
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="help-modal" class="overlay hidden">
    <div class="modal-card help-card">
      <div class="modal-header">
        <h2>Ayuda</h2>
        <button id="help-close" class="btn-icon-close">âœ•</button>
      </div>
      <div class="help-content">
        <div class="help-section">
          <h4>âœ¦ Crear una nota</h4>
          <p>Pulsa el botÃ³n <strong>+</strong> para crear una nueva nota. Elige entre PoesÃ­a o CanciÃ³n y sigue el asistente de estructura.</p>
        </div>
        <div class="help-section">
          <h4>â— Estructura de poesÃ­a</h4>
          <p>El soneto guÃ­a 14 versos en 4 estrofas. El haiku te muestra las sÃ­labas objetivo 5-7-5. El verso libre no tiene lÃ­mites.</p>
        </div>
        <div class="help-section">
          <h4>â™© Estructura de canciÃ³n</h4>
          <p>Usa los botones de secciÃ³n (Intro, Verso, Pre-estribillo, Estribillo, Puente, Outro) para insertar marcadores en tu letra.</p>
        </div>
        <div class="help-section">
          <h4>â—‰ Contador de sÃ­labas</h4>
          <p>Siempre activo. Selecciona cualquier verso para ver sus sÃ­labas. Activa "MÃ©trica" en Ajustes para ver el nombre del verso.</p>
        </div>
        <div class="help-section">
          <h4>â¬¡ OrganizaciÃ³n</h4>
          <p>AÃ±ade tags a tus notas y mÃ¡rcalas como favoritas con la estrella â˜†. Filtra desde la pantalla principal.</p>
        </div>
        <div class="help-section">
          <h4>â†— Compartir</h4>
          <p>Cada nota tiene un botÃ³n para copiar al portapapeles o descargar como TXT o PDF.</p>
        </div>
        <div class="help-section">
          <h4>âš™ Instalar la app</h4>
          <p>Ve a Ajustes â†’ "Instalar app". En Chrome/Edge verÃ¡s un botÃ³n directo. En Safari iOS sigue las instrucciones de Compartir â†‘.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       MODAL: COMPARTIR NOTA
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="share-modal" class="overlay hidden">
    <div class="modal-card share-card">
      <div class="modal-header">
        <h2>Compartir nota</h2>
        <button id="share-close" class="btn-icon-close">âœ•</button>
      </div>
      <div class="share-actions">
        <button id="share-clipboard" class="share-btn"><span>ğŸ“‹</span> Copiar al portapapeles</button>
        <button id="share-txt" class="share-btn"><span>ğŸ“„</span> Descargar como TXT</button>
        <button id="share-pdf" class="share-btn"><span>ğŸ–¨</span> Imprimir / PDF</button>
      </div>
      <div id="share-toast" class="share-toast hidden">Â¡Copiado al portapapeles!</div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       MODAL: GESTIÃ“N DE TAGS
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="tag-modal" class="overlay hidden">
    <div class="modal-card">
      <div class="modal-header">
        <h2>Gestionar tags</h2>
        <button id="tag-close" class="btn-icon-close">âœ•</button>
      </div>
      <div class="tag-input-row">
        <input type="text" id="tag-input" placeholder="Nuevo tag..." class="text-input" />
        <button id="tag-add" class="btn-primary small">AÃ±adir</button>
      </div>
      <div id="tag-list" class="tag-list"></div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       APP PRINCIPAL
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="app">

    <!-- â”€â”€ VISTA: LISTA DE NOTAS â”€â”€ -->
    <div id="view-list" class="view">
      <header class="app-header">
        <div class="header-brand">
          <span class="brand-symbol">âˆ</span>
          <h1>Infiniversal</h1>
        </div>
        <div class="header-actions">
          <button id="btn-help" class="btn-icon" aria-label="Ayuda">?</button>
          <button id="btn-settings" class="btn-icon" aria-label="Ajustes">âš™</button>
        </div>
      </header>

      <div class="filter-bar">
        <button class="filter-btn active" data-filter="all">Todas</button>
        <button class="filter-btn" data-filter="poem">PoesÃ­a</button>
        <button class="filter-btn" data-filter="song">Canciones</button>
        <button class="filter-btn" data-filter="fav">Favoritas</button>
        <button class="filter-btn" data-filter="tags" id="filter-tags-btn">Tags â–¾</button>
      </div>

      <div id="active-tags-bar" class="active-tags-bar hidden"></div>

      <main id="notes-list" class="notes-list">
        <div class="empty-state" id="empty-state">
          <div class="empty-symbol">âœ¦</div>
          <p>Tu lienzo estÃ¡ vacÃ­o.<br>Crea tu primera nota.</p>
        </div>
      </main>

      <button id="btn-new" class="fab" aria-label="Nueva nota">+</button>
    </div>

    <!-- â”€â”€ VISTA: EDITOR â”€â”€ -->
    <div id="view-editor" class="view hidden">
      <header class="editor-header">
        <button id="btn-back" class="btn-icon" aria-label="Volver">â†</button>
        <div class="editor-header-center">
          <span id="editor-type-badge" class="type-badge"></span>
        </div>
        <div class="editor-header-actions">
          <button id="btn-fav" class="btn-icon" aria-label="Favorito">â˜†</button>
          <button id="btn-tags" class="btn-icon" aria-label="Tags">âŠ›</button>
          <button id="btn-share" class="btn-icon" aria-label="Compartir">â†—</button>
        </div>
      </header>

      <div id="song-toolbar" class="song-toolbar hidden">
        <button class="section-btn" data-section="Intro">Intro</button>
        <button class="section-btn" data-section="Verso">Verso</button>
        <button class="section-btn" data-section="Pre-estribillo">Pre-est.</button>
        <button class="section-btn" data-section="Estribillo">Estribillo</button>
        <button class="section-btn" data-section="Puente">Puente</button>
        <button class="section-btn" data-section="Outro">Outro</button>
      </div>

      <div id="poem-guide" class="poem-guide hidden"></div>

      <div id="rich-toolbar" class="rich-toolbar hidden">
        <button class="fmt-btn" data-cmd="bold"><strong>N</strong></button>
        <button class="fmt-btn" data-cmd="italic"><em>K</em></button>
        <button class="fmt-btn" data-cmd="underline"><u>S</u></button>
        <button class="fmt-btn" data-cmd="undo">â†©</button>
        <button class="fmt-btn" data-cmd="redo">â†ª</button>
      </div>

      <div id="metric-toolbar" class="metric-toolbar hidden">
        <span class="metric-label">MÃ©trica:</span>
        <span id="metric-syllables" class="metric-value">â€” sÃ­l.</span>
        <span class="metric-sep">|</span>
        <span class="metric-label">Verso:</span>
        <span id="metric-type" class="metric-value">â€”</span>
      </div>

      <input type="text" id="note-title" class="note-title-input" placeholder="TÃ­tulo..." />
      <div id="note-tags-bar" class="note-tags-bar"></div>

      <div id="note-editor"
           class="note-editor"
           contenteditable="true"
           spellcheck="true"
           aria-multiline="true"
           aria-label="Editor de nota"
           data-placeholder="Comienza a escribir..."></div>

      <div class="editor-stats">
        <span id="stat-words">0 palabras</span>
        <span class="stat-sep">Â·</span>
        <span id="stat-syllables">0 sÃ­l.</span>
        <span class="stat-sep">Â·</span>
        <span id="stat-chars">0 car.</span>
      </div>

      <div id="plain-undo-bar" class="plain-undo-bar">
        <button id="btn-undo" class="btn-ghost small">â†© Deshacer</button>
        <button id="btn-redo" class="btn-ghost small">â†ª Rehacer</button>
      </div>
    </div>

  </div><!-- /#app -->

  <script src="app.js"></script>
</body>
</html>
